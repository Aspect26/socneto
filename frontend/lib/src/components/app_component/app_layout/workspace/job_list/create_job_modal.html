<modal [(visible)]="displayed">
    <material-dialog headered
                     class="dialog"
                     [error]="errorMessage">

        <div header>
            <h1>Create new job</h1>
            <material-button icon autoFocus [disabled]="submitting" (trigger)="onCloseDialog()">
                <material-icon icon="close"></material-icon>
            </material-button>
        </div>

        <material-stepper #jobStepper
                          legalJumps="all"
                          orientation="horizontal">

            <template step name="Job Definition"
                      [optional] = "false"
                      [hideButtons]="true">

                <div>
                    Title:
                    <material-input
                            label="Name of the job"
                            floatingLabel
                            [(ngModel)]="jobName"
                            [disabled]="submitting"
                            class="labeled-input">
                    </material-input>

                    <div>
                        Topic:
                        <material-input
                                label="The topic to be queried"
                                floatingLabel
                                [(ngModel)]="topic"
                                [disabled]="submitting"
                                class="labeled-input">
                        </material-input>
                    </div>

                    <div>
                        Language:
                        <material-dropdown-select
                            [options]="['en', 'cs']"
                            [(selection)]="languageSelection"
                            [itemRenderer]="languagesItemRenderer"
                            [buttonText]="languageSelection.selectedValue"
                            [disabled]="submitting"
                            class="language-select">
                        </material-dropdown-select>
                    </div>

                    Data acquirers:
                    <components-select
                            [components]="availableSocialNetworks"
                            [loading]="loadingSocialNetworks"
                            [disabled]="submitting"
                            (change)="onSocialNetworksSelectionChange($event)"
                            (refresh)="onSocialNetworksRefresh()">
                    </components-select>

                    Data analyzers:
                    <components-select
                            [components]="availableDataAnalyzers"
                            [loading]="loadingDataAnalyzers"
                            [disabled]="submitting"
                            (change)="onDataAnalyzersSelectionChange($event)"
                            (refresh)="onDataAnalyzersRefresh()">
                    </components-select>
                </div>

            </template>

            <template step name="Credentials"
                      [optional]="true"
                      [hideButtons]="true">

                <div>
                    <material-tab-panel [activeTabIndex]="0">

                        <material-tab class="tab" label="Twitter">

                            <div>
                                <material-toggle [(ngModel)]="useCustomTwitterCredentials" [disabled]="submitting" label="Use custom"></material-toggle>
                            </div>

                            <material-input
                                    floatingLabel
                                    label="Api Key"
                                    [disabled]="!useCustomTwitterCredentials || submitting"
                                    [(ngModel)]="twitterCredentials.apiKey"
                                    class="labeled-input">
                            </material-input>

                            <material-input
                                    floatingLabel
                                    label="Api Secret Key"
                                    [disabled]="!useCustomTwitterCredentials || submitting"
                                    [(ngModel)]="twitterCredentials.apiSecretKey"
                                    class="labeled-input">
                            </material-input>

                            <material-input
                                    floatingLabel
                                    label="Access Token"
                                    [disabled]="!useCustomTwitterCredentials || submitting"
                                    [(ngModel)]="twitterCredentials.accessToken"
                                    class="labeled-input">
                            </material-input>

                            <material-input
                                    floatingLabel
                                    label="Access Token Secret"
                                    [disabled]="!useCustomTwitterCredentials || submitting"
                                    [(ngModel)]="twitterCredentials.accessTokenSecret"
                                    class="labeled-input">
                            </material-input>

                        </material-tab>

                        <material-tab class="tab" label="Reddit">

                            <div>
                                <material-toggle [(ngModel)]="useCustomRedditCredentials" [disabled]="submitting" label="Use custom"></material-toggle>
                            </div>

                            <material-input
                                    floatingLabel
                                    label="Application ID"
                                    [disabled]="!useCustomRedditCredentials || submitting"
                                    [(ngModel)]="redditCredentials.appId"
                                    class="labeled-input">
                            </material-input>

                            <material-input
                                    floatingLabel
                                    label="Application Secret Key"
                                    [disabled]="!useCustomRedditCredentials || submitting"
                                    [(ngModel)]="redditCredentials.appSecret"
                                    class="labeled-input">
                            </material-input>

                            <material-input
                                    floatingLabel
                                    label="Refresh Token"
                                    [disabled]="!useCustomRedditCredentials || submitting"
                                    [(ngModel)]="redditCredentials.refreshToken"
                                    class="labeled-input">
                            </material-input>

                        </material-tab>

                    </material-tab-panel>
                </div>

            </template>

        </material-stepper>

        <div footer>
            <material-button *ngIf="!submitting && jobStepper.activeStepIndex != 1" (trigger)="jobStepper.stepForward($event, jobStepper.activeStep)" transparent>Custom credentials (optional)</material-button>
            <material-button *ngIf="!submitting" [disabled]="!isJobDefinitionCorrect()" class="close-button" (trigger)="onSubmit()">Submit</material-button>
            <material-spinner *ngIf="submitting"></material-spinner>
        </div>

    </material-dialog>
</modal>